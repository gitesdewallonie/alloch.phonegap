<!DOCTYPE html>
<html>
<head>
<title>title</title>
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<script type="text/javascript" charset="utf-8" src="phonegap-1.2.0.js"></script>
 <link href="jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
 <script src="jquery-1.7.1.min.js" type="text/javascript"></script>
 <script src="jquery.mobile-1.0.min.js" type="text/javascript"></script>

<script type="text/javascript">




//Lien call ajax pour POC
//http://gitesdewallonie.be/selectedDays?hebPk=81&month=1&year=2012&range=1

// google
//http://maps.googleapis.com/maps/api/geocode/json?address=XXX&sensor=false

// If you want to prevent dragging, uncomment this section
/*
function preventBehavior(e) 
{ 
  e.preventDefault(); 
};
document.addEventListener("touchmove", preventBehavior, false);
*/

/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
for more details -jm */
/*
function handleOpenURL(url)
{
	// TODO: do something with the url passed in.
}
*/

function onBodyLoad()
{		
	document.addEventListener("deviceready", onDeviceReady, false);
}

/* When this function is called, PhoneGap has been initialized and is ready to roll */
/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
for more details -jm */

function onDeviceReady()
{
    alert("ok");

	//navigator.notification.alert("PhoneGap is working");		
}

//geoloc functions
var onSuccess = function(position) {
    $("#results #content").html('Latitude: '+ position.coords.latitude + '<br />' +
      'Longitude: '         + position.coords.longitude         + '<br /><img id="map" /><div id="ajaxResults"></div>');  
         var url = "http://maps.google.com/maps/api/staticmap?center=" +  position.coords.latitude + "," +position.coords.longitude + "&zoom=13&size=160x240&maptype=roadmap&key=MyGoogleMapsAPIKey&sensor=true";
        document.getElementById('map').setAttribute('src',url);
        $.getJSON(" http://clavius.affinitic.be:8877/plone/getMobileClosestHebs?address=canadiens+hyon", {}, function(data) {
            console.log(data.results.length);
            var l = data.results.length;
            
           var html ='<ul data-role="listview" data-theme="g">'
            for(var i = 0;i< l;i++)
            {
                html+='<li><a href="#details">'+data.results[i].name+'</a></li>';
            }
            html +='</ul>';
            $('#results #content #ajaxResults').html(html);
         })
        
};

// onError Callback receives a PositionError object
//
function onError(error) {
    alert('code: '    + error.code    + '\n' +
          'message: ' + error.message + '\n');
}
/////end hgeoloc functions


$(document).ready(function() {
      
       $("#geoLocalise").click(function(e) {
             e.preventDefault();
             navigator.geolocation.getCurrentPosition(onSuccess, onError);             
          });
});
</script>
</head>
<body onload="onBodyLoad();">
    <div data-role="page" id="home">

    	<div data-role="header">
    		<h1>Allo chambres d'hotes !</h1>
    	</div><!-- /header -->

    	<div data-role="content">	
    	    	
            <p> <a href="#results" data-role="button" id="geoLocalise">G&eacute;olocalise moi</a></p>
            <div data-role="fieldcontain">
                 <label for="search">Search Input:</label>
                 <input type="search" name="adress" id="search" value="" />
             </div>
    			
    	</div><!-- /content -->

    
    </div><!-- /page -->
    <div data-role="page" id="results" >
        
    	    	<div data-role="header">
    	    	    <a href="#home" data-icon="arrow-l">Back</a>
            		<h2>R&eacute;sultats!</h2>
            	</div><!-- /header -->

    	<div data-role="content" id="content">	
	         
    	</div><!-- /content -->

    
    </div><!-- /page -->
    <div data-role="page" id="details">

    	<div data-role="header">
    	     <a href="#results" data-icon="arrow-l">Back</a>
    		<h1>DÃ©tails</h1>
    	</div><!-- /header -->

    	<div data-role="content">	
    		<p>Page content goes here.</p>		
    	</div><!-- /content -->

    	
    </div><!-- /page -->
    <div data-role="page" id="credits">

    	<div data-role="header">
    		<h1>Page Title</h1>
    	</div><!-- /header -->

    	<div data-role="content">	
    		<p>Page content goes here.</p>		
    	</div><!-- /content -->

    
    </div><!-- /page -->
</body>
</html>